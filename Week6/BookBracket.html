<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <button
      title="Click to submit your ratings once you have selected one book in each pairing."
      id="submit"
      onclick="createBoxes()"
      onmouseover="checkIfReadyToSubmit()"
      onmouseout="this.style.background = ''"
    >
      Click to Submit Rankings
    </button>
    <script src="./myBooks.js"></script>
    <script>
      let heightOfEachBox = 0;
      let totalNumberOfBooksWithARatingOfFive = 0; 
      let exponentOfTwo = Math.ceil(Math.log2(totalNumberOfBooksWithARatingOfFive));
      let numberOfBooks = 0;
      const bracketWidth = 1350;
      const bracketHeight = 500;
      let readyToSubmit = true;
        const arrayOfBooksIHaveRead = myBooks.haveRead;

    const createArrayOfBooksIRatedAFive = () => {
        const filteredByRatingOfFive = arrayOfBooksIHaveRead.filter((item) => item[2] === 5);
        totalNumberOfBooksWithARatingOfFive = filteredByRatingOfFive.length;
        numberOfBooks = totalNumberOfBooksWithARatingOfFive;
        
        return filteredByRatingOfFive;
    }

      const createBoxes = () => {
        if (readyToSubmit) {
            
            console.log(numberOfBooks);
          exponentOfTwo = Math.ceil(Math.log2(numberOfBooks));
          
          let horizontalSpacing = calculateHorizontalSpacing(exponentOfTwo);
          for (let i = 0; i < 2 ** exponentOfTwo; i++) {
            let box = document.createElement("div");
            box.style.position = "absolute";
            box.style.zIndex = 1;
            box.style.backgroundColor = "rgb(218,210,210)";
            box.style.borderStyle = "solid";
            box.style.borderColor = "black;";
            box.style.width = horizontalSpacing + "px";
            box.style.height = heightOfEachBox + "px";
            box.style.left = horizontalSpacing * (2 * i + 1) + "px";
            box.style.top = heightOfEachBox * (3 * exponentOfTwo + 1) + "px";
            box.style.display = "flex";
            box.style.justifyContent = "center";
            box.style.alignItems = "center";
            box.innerHTML = "test";
            if (exponentOfTwo === 0 && i === 0) {
              box.setAttribute("id", "winner");
              box.setAttribute("onclick", `update('winner')`);
              box.style.backgroundColor = "steelblue";
            } else {
              box.setAttribute("id", `${exponentOfTwo}` + `${i}`);
              box.setAttribute("onclick", `update(${exponentOfTwo}` + `${i})`);
            }
            document.body.appendChild(box);
            
          }
          numberOfBooks = 2 ** (exponentOfTwo - 1);
          readyToSubmit = false;
        }
      };
      const calculateHorizontalSpacing = (exponentOfTwo) => {
        return bracketWidth / (2 ** (exponentOfTwo + 1) + 1);
      };

      const calculateVerticalSpacing = (totalNumberOfBooksWithARatingOfFive) => {
        let highestExponentOfTwo = Math.ceil(Math.log2(totalNumberOfBooksWithARatingOfFive));
        heightOfEachBox =
          bracketHeight /
          (highestExponentOfTwo + 2 * (highestExponentOfTwo - 1));
      };

      const checkIfReadyToSubmit = () => {
        let numberOfGreenBooksInCurrentRound = 0;
        for (let i = 0; i < 2 ** exponentOfTwo; i++) {
          let id = "" + exponentOfTwo + i;

          if (
            document.getElementById(id).style.backgroundColor === "lightblue"
          ) {
            numberOfGreenBooksInCurrentRound++;
          }
        }
        if (numberOfGreenBooksInCurrentRound === 2 ** exponentOfTwo / 2) {
          readyToSubmit = true;
        }
        if (readyToSubmit) {
          document.getElementById("submit").style.backgroundColor =
            "darkseagreen";
        } else {
          document.getElementById("submit").style.backgroundColor = "tomato";
        }
      };

      const update = (id) => {
        console.log(id);
        if (id !== "winner") {
          document.getElementById(id).style.backgroundColor = "lightblue";
          if (id % 2 === 0) {
            document.getElementById(id + 1).style.backgroundColor =
              "rgb(218,210,210)";
          } else {
            document.getElementById(id - 1).style.backgroundColor =
              "rgb(218,210,210)";
          }
        }
      };
      createArrayOfBooksIRatedAFive();
      calculateVerticalSpacing(totalNumberOfBooksWithARatingOfFive);
      createBoxes();
    </script>
  </body>
</html>
